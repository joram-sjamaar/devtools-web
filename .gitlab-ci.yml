image: "node:13-alpine"

backend test:
  script:
    - cd ./backend
    - npm ci --cache .npm --prefer-offline
    - npm run test:report
  artifacts:
    paths:
      - ./backend/reports
    expire_in: 1 week
  only:
    changes:
      - backend/*
  cache:
    key: ${CI_COMMIT_REF_SLUG}
    paths:
    - ./backend/.npm/

backend coverage:
  script:
    - cd ./backend
    - npm run test:coverage-html
  artifacts:
    paths:
      - ./backend/coverage
    expire_in: 1 week
  only:
    changes:
      - backend/*
  cache:
    key: ${CI_COMMIT_REF_SLUG}
    paths:
    - ./backend/.npm/

backend docs:
  script:
    - cd ./backend
    - npm run jsdoc
    - npm run apidoc
  artifacts:
    paths:
      - ./backend/jsdoc
      - ./backend/apidoc
    expire_in: 1 week
  only:
    changes:
      - backend/*
  cache:
    key: ${CI_COMMIT_REF_SLUG}
    paths:
    - ./backend/.npm/

frontend build:
  script:
    - cd ./frontend
    - npm ci --cache .npm --prefer-offline
    - npm run build
  artifacts:
    paths:
      - ./frontend/dist
      - ./frontend/index.html
    expire_in: 1 week
  only:
    changes:
      - frontend/*
  cache:
    key: ${CI_COMMIT_REF_SLUG}
    paths:
    - ./frontend/.npm/